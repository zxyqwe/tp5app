{layout name="layout2" /}
<div class="container-fluid" style="padding-bottom: 70px;">
    <div id="container" class="col-md-10 col-md-offset-1 column">
        <div id="body">
            <div class="row">
                <div class="col-md-2">
                    <h2>日志列表</h2>
                    <div id="dir_tree"></div>
                </div>
                <div class="col-md-10">
                    <h2 id="log_title"></h2>
                    <pre id="log_cont"></pre>
                </div>
            </div>
        </div>
    </div>
    <div class="sr-only" id="dir_data">{$data}</div>
</div>
<script>
    var nav = 'nav2_9';
    //ToDo
    var tlog = (function ($, w, undefined) {
        'use strict';
        var $tree, $cont, $title;
        var cont = function (c, t) {
            $cont.html(c);
            $title.html(t);
        };
        var up = function (par, chi) {
            w.waitloading();
            $.ajax({
                type: "POST",
                url: w.u12,
                data: {
                    par: par,
                    chi: chi
                },
                dataType: "json",
                success: function (msg) {
                    cont(msg.text, par + ' - ' + chi);
                },
                error: function (msg) {
                    msg = JSON.parse(msg.responseText);
                    w.msgto(msg.msg);
                },
                complete: function () {
                    w.cancelloading();
                }
            });
        };
        var init = function () {
            $tree = $('#dir_tree');
            $cont = $('#log_cont');
            $title = $('#log_title');
            var data = $('#dir_data').html();
            data = JSON.parse(data);
            $tree.treeview({
                levels: 1,
                data: data,
                onNodeSelected: function (event, data) {
                    if (undefined !== data.nodes) {
                        $tree.treeview('expandNode', [data.nodeId, {silent: true}]);
                        return;
                    }
                    var parent = $tree.treeview('getParent', data);
                    $tree.treeview('expandNode', [parent.nodeId, {silent: true}]);
                    up(parent.text, data.text);
                },
                onNodeUnselected: function (event, data) {
                    cont('', '');
                    if (undefined !== data.nodes) {
                        $tree.treeview('collapseNode', [data.nodeId, {silent: true}]);
                    }
                }
            });
        };
        return {
            init: init
        };
    })(jQuery, window);
    $(window).on("load", function () {
        tlog.init();
    });
</script>