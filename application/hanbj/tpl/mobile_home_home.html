<div class="page">
    <div class="page__hd">
        <h1 class="page__title">主页</h1>
        <p class="page__desc">个人中心</p>
    </div>
    <div class="page__bd page__bd_spacing">
        <div class="weui-flex {$card==1 ? 'sr-only':''}" style="background-color: #ebebeb;">
            <div class="weui-flex__item">
                <div class="placeholder slideShine">
                    会员卡流程还没完成，看看“微信-卡包”里面有嘛？
                </div>
            </div>
        </div>
        <div class="weui-flex">
            <div class="weui-flex__item">
                <div class="placeholder">
                    <a id="card0" href="javascript:;" class="weui-btn weui-btn_plain-primary sr-only">
                        <i class="weui-loading sr-only"></i>激活会员卡</a>
                    <a id="card1" href="javascript:;" class="weui-btn weui-btn_plain-primary sr-only">
                        <i class="weui-loading sr-only"></i>查看会员卡</a>
                    <a id="card-1" href="javascript:;" class="weui-btn weui-btn_plain-primary sr-only">
                        <i class="weui-loading sr-only"></i>领取会员卡</a>
                </div>
            </div>
        </div>
        <div class="weui-cells__title">个人信息</div>
        <div class="weui-cells">
            <a class="weui-cell weui-cell_access" href="/hanbj/mobile/help">
                <div class="weui-cell__bd">
                    <p>会员状态</p>
                </div>
                <div class="weui-cell__ft">{$user.code}</div>
            </a>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>会员编号</p>
                </div>
                <div class="weui-cell__ft">{$user.unique_name}</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>昵称</p>
                </div>
                <div class="weui-cell__ft">{$user.tieba_id}</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>性别</p>
                </div>
                <div class="weui-cell__ft">{$user.gender}</div>
            </div>
            <a class="weui-cell weui-cell_access" href="javascript:wx_home.pref('{$user.pref}')">
                <div class="weui-cell__bd">
                    <p>兴趣爱好</p>
                </div>
                <div class="weui-cell__ft">{$user.pref}</div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:wx_home.web('{$user.web_name}')">
                <div class="weui-cell__bd">
                    <p>常用网名</p>
                </div>
                <div class="weui-cell__ft">{$user.web_name}</div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:wx_home.select_birth('{$user.birth}')">
                <div class="weui-cell__bd">
                    <p>生日</p>
                </div>
                <div class="weui-cell__ft">{$user.birth}</div>
            </a>
            <a class="weui-cell weui-cell_access" href="javascript:select_location('{$user.location}')">
                <div class="weui-cell__bd">
                    <p>地区</p>
                </div>
                <div class="weui-cell__ft" id="trans_location">{$user.location}</div>
            </a>
        </div>
        <div class="weui-cells__title">联系方式</div>
        <div class="weui-cells">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>手机</p>
                </div>
                <div class="weui-cell__ft">{$user.phone}</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>QQ</p>
                </div>
                <div class="weui-cell__ft">{$user.QQ}</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>邮件</p>
                </div>
                <div class="weui-cell__ft">{$user.mail}</div>
            </div>
        </div>
        <div class="weui-cells__title">会员状态</div>
        <div class="weui-cells">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>注册年份</p>
                </div>
                <div class="weui-cell__ft">{$user.year_time}</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>会龄</p>
                </div>
                <div class="weui-cell__ft">{$user.duration} 天</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>缴费到期</p>
                </div>
                <div class="weui-cell__ft">
                    <i class="{$status? 'weui-icon-success' : 'weui-icon-warn'}"></i>
                    {$user.fee_str}
                </div>
            </div>
            <a class="weui-cell weui-cell_access" href="#bonus">
                <div class="weui-cell__bd">
                    <p>当前积分</p>
                </div>
                <div class="weui-cell__ft">{$user.bonus}</div>
            </a>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>积分排名</p>
                </div>
                <div class="weui-cell__ft">{$user.bonus_top}</div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p>审核人</p>
                </div>
                <div class="weui-cell__ft">{$user.master}</div>
            </div>
        </div>
        <div class="weui-panel">
            <div class="weui-panel__hd">详情页</div>
            <div class="weui-panel__bd">
                <div class="weui-grids">
                    <a href="/hanbj/mobile/help" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #5bc0de">帮助中心</p>
                    </a>

                    <a href="#activity" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary">活动记录</p>
                    </a>

                    <a href="#prom" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #7785de">商家优惠</p>
                    </a>

                    <a href="#valid" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #de9274">缴费记录</p>
                    </a>
                    <a href="#valid_fee" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #de9274">会费缴纳</p>
                    </a>
                    <!--                    <a href="/hanbj/pub/bulletin" class="weui-grid">-->
                    <!--                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #de9274">会费公示</p>-->
                    <!--                    </a>-->

                    <a href="#bonus" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #d995de">当前积分</p>
                    </a>
                    <a href="/hanbj/pub/bonus" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #d995de">积分排行</p>
                    </a>

                    <a href="#history" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_plain-primary">任职履历</p>
                    </a>
                    <a href="/hanbj/pub/fame" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_plain-primary">汉北名人</p>
                    </a>

                    <!--<a href="/hanbj/wxclub" class="weui-grid">-->
                    <!--<p class="weui-btn weui-btn_mini weui-btn_primary" style="background-color: #dede3f;border: 1px solid #dede3f;">见微知萌</p>-->
                    <!--</a>-->

                    <!--<a href="#vote" class="weui-grid">-->
                    <!--<p class="weui-btn weui-btn_mini weui-btn_primary">换届选举</p>-->
                    <!--</a>-->
                </div>
            </div>
        </div>
        <div id="workarea" class="weui-panel sr-only">
            <div class="weui-panel__hd">工作人员专区：{$user.tieba_id}</div>
            <div class="weui-panel__bd">
                <div class="weui-grids">
                    <!--<a href="javascript:" class="weui-grid" id="work_act">-->
                    <!--<p class="weui-btn weui-btn_mini weui-btn_primary">活动登记</p>-->
                    <!--</a>-->
                    <!--<a href="#work_act_log" class="weui-grid">-->
                    <!--<p class="weui-btn weui-btn_mini weui-btn_primary">登记日志</p>-->
                    <!--</a>-->
                    <a href="#todo" class="weui-grid">
                        <p class="weui-btn weui-btn_mini weui-btn_primary">待办列表</p>
                    </a>
                </div>
            </div>
        </div>
        <div class="weui-panel">
            <div class="weui-panel__bd">
                <a href="/hanbj/mobile/logout" class="weui-footer__link">注销登陆</a>
            </div>
        </div>
    </div>
    <div class="page__ft">
    </div>
</div>
<script type="text/javascript">
    var $card = "{$card}";
    var $status = $('#card' + $card);
    var worker = "{$worker}";
    wx_home.init();
    var w = window;
    w.trans_location_func = function () {
        var trans_location_dom = $('#trans_location');
        var name = trans_location_dom.html();
        if (name.length !== 6) {
            return;
        }
        name = [name.substr(0, 2), name.substr(2, 2), name.substr(4, 2)];
        for (var idx in w.regions) {
            idx = w.regions[idx];
            if (idx.value !== name[0]) {
                continue;
            }
            for (var idx2 in idx.children) {
                idx2 = idx.children[idx2];
                if (idx2.value !== name[1]) {
                    continue;
                }
                for (var idx3 in idx2.children) {
                    idx3 = idx2.children[idx3];
                    if (idx3.value !== name[2]) {
                        continue;
                    }
                    console.log(idx);
                    console.log(idx2);
                    console.log(idx3);
                    trans_location_dom.html(idx.label + idx2.label + idx3.label);
                }
            }
        }
    };
    trans_location_func();
    var change_location = function (old_num, new_num, new_label) {
        var trans_location_dom = $('#trans_location');
        var name = trans_location_dom.html();
        var str = '<div class="weui-cells weui-cells_form" style="margin-top: 0"><div class="weui-cell">' +
            '<div class="weui-cell__hd"><label class="weui-label">旧地区' +
            '</label></div><div class="weui-cell__bd">' + name +
            '</div></div><div class="weui-cell"><div class="weui-cell__hd"><label class="weui-label">新地区' +
            '</label></div><div class="weui-cell__bd"><div class="weui-cell__bd">' + new_label +
            '</div></div></div></div>';
        return weui.confirm(str, function () {
            if (old_num === new_num) {
                return false;
            }
            w.waitloading();
            $.ajax({
                type: "POST",
                url: w.u14 + '?action=location',
                dataType: "json",
                data: {
                    _ajax: 1,
                    old: old_num,
                    new: new_num
                },
                success: function (msg) {
                    w.msgok();
                    w.location.reload(true);
                    w.location.search += '&_=' + Date.now();
                },
                error: w.msgto,
                complete: function () {
                    w.cancelloading();
                }
            });
        }, {
            title: '修改地区'
        });
    };
    w.select_location = function (old_name) {
        if ('{$user.unique_name}' !== '坎丙午') {
            return;
        }
        var name = old_name.toString();
        if (name.length === 6) {
            name = [name.substr(0, 2), name.substr(2, 2), name.substr(4, 2)];
        } else {
            name = ['11', '01', '08'];
        }
        weui.picker(regions, {
            depth: 3,
            defaultValue: name,
            onConfirm: function (result) {
                var value = result[0].value + result[1].value + result[2].value;
                var label = result[0].label + result[1].label + result[2].label;
                console.log(value);
                console.log(label);
                change_location(old_name, value, label);
            },
            id: 'select_location_picker'
        });
    };
</script>