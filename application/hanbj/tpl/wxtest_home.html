{layout name="wxlayout" /}
<script type="text/html" id="tpl_home">
    <div class="page" id="objmain">
        <div class="page__hd">
            <h1 class="page__title">目标：{{ uname }}</h1>
            <p class="page__desc">批次：{{ name }}</p>
        </div>
        <div class="page__bd page__bd_spacing">
            <div class="weui-cells__title"><h1>{{ cur_q }}</h1></div>
            <div class="weui-cells" v-show="cur_a">
                <div class="weui-cell" v-for="item in cur_a">
                    <div class="weui-cell__bd">
                        <p>{{ item }}</p>
                    </div>
                    <div class="weui-cell__ft"></div>
                </div>
            </div>
            <div class="weui-flex" v-show="cur_a">
                <div class="weui-flex__item">
                    <div class="placeholder">
                        <h1>请打分：{{ slidepos }}</h1>
                    </div>
                </div>
            </div>
            <div class="weui-flex" v-show="cur_a">
                <div class="weui-flex__item">
                    <div class="placeholder">
                        <div class="weui-slider-box">
                            <div id="slider" class="weui-slider">
                                <div class="weui-slider__inner">
                                    <div class="weui-slider__track"></div>
                                    <div class="weui-slider__handler"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="weui-flex">
                <div class="weui-flex__item" v-show="cur_i > 0">
                    <div class="placeholder">
                        <a href="javascript:" class="weui-btn weui-btn_plain-primary" v-on:click="next(-1)">上一题</a>
                    </div>
                </div>
                <div class="weui-flex__item" v-show="cur_i < test.length - 1">
                    <div class="placeholder">
                        <a href="javascript:" class="weui-btn weui-btn_primary" v-on:click="next(1)">下一题</a>
                    </div>
                </div>
                <div class="weui-flex__item" v-show="cur_i === test.length - 1">
                    <div class="placeholder">
                        <a href="javascript:" class="weui-btn weui-btn_plain-primary" v-on:click="up()">提交</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="page__ft">
        </div>
    </div>
</script>
<!--<script type="text/javascript" src="/static/wx_test.js"></script>-->
<div id="testdata" class="sr-only">{$obj}</div>
<script>
    window.test = [
        {
            q: '你对A会长分管部门（无具体分管的，则评价各个部门）工作情况评价（40分）'
        },
        {
            q: '任务完成及实际效果（10分）',
            a: [
                '超额完成工作任务，效果完美，意义影响大（10分）',
                '完成所有工作任务，效果有积极作用（8-9分）',
                '基本完成工作任务，工作效果平平（6-7分）',
                '有明显未完成的任务，且没有替代性工作；或工作效果差，甚至有负面影响（5分及以下）'
            ]
        },
        {
            q: '团队管理与协作（10分）',
            a: [
                '内部分工清晰科学、配合顺畅，凝聚力很强10分）',
                '有一定的分工协作，具有团队意识（8-9分）',
                '成员勤怠程度参差不齐，勉强算是团队（6-7分）',
                '几乎无分工配合，整体散漫懈怠（5分及以下）'
            ]
        },
        {
            q: '人才培养与个人纪律（10分）',
            a: [
                '骨干很好地带动教导干事，成员很好地履行参会、活动等义务（10分）',
                '骨干做给干事看，有心人能有所提高，成员基本能守纪律（8-9分）',
                '骨干爱单干，干事难以提高，有不守纪律情况发生（6-7分）',
                '完全不管干事培养问题，成员违纪情况时有发生。（5分及以下）'
            ]
        },
        {
            q: '工作创新和团队进取心（10分）',
            a: [
                '团队思维活跃，工作上各种推陈出新（10分）',
                '不满足于按部就班，能作出一些新业绩（8-9分）',
                '基本按照固有套路工作，偶有创新改进（6-7分）',
                '无进取心和创新意识，应付工作（5分及以下）'
            ]
        },
        {
            q: '你对A会长个人工作状态的评价（60分）'
        }, {
            q: '履职尽责（本题与其他题目不同，按照分支问题给分即可，共20分）',
            a: [
                '带头积极参加全年会议与活动（6分）',
                '主动协调、指导和配合会务或活动组织（4分）',
                '遵守会议纪律和活动纪律（5分）',
                '及时批复签报，参与或作出决策（5分）'
            ],
            s: 20
        },
        {
            q: '工作态度（10分）',
            a: [
                '任劳任怨，用于担当，竭尽所能完成工作。10分',
                '有责任心，能较好完成分内工作。8-9分',
                '需要提醒督促勉强完成工作。6-7分',
                '敷衍了事,态度傲慢，无责任心，粗心、拖拉。5分及以下'
            ]
        },
        {
            q: '领导能力（10分）',
            a: [
                '善于分配工作，积极传授工作知识技能，引导下属完成任务。10分',
                '能够较好的分配工作，有效传授工作知识技能，指导下属完成工作任务。8-9分',
                '本能够合理地分配工作，具备一定指导下属工作的能力。6-7分',
                '欠缺分配工作及指导下属的工作方法，工作任务完成偶有困难。5分及以下'
            ]
        },
        {
            q: '团队意识（10分）',
            a: [
                '工作有计划，与其他会长和分管部门配合无间，工作完成顺利。10分',
                '爱护团体，常主动帮助指导别人。8-9分',
                '肯应他人要求帮助别人。6-7分',
                '自由散漫，蛮横不妥协，难以合作。5分及以下'
            ]
        },
        {
            q: '创新意识（10分）',
            a: [
                '创新能力和大局观强，在工作改善方面，常提出建设性意见并采纳。10分',
                '有一定创新意识和能力，有时在工作方法上有改进。8-9分',
                '创新意识一般，偶尔有改进建议，能完成任务。6-7分',
                '毫无创新，只能基本完成任务；5分及以下'
            ]
        }
    ];
    var wx_test = (function ($, Vue, w, undefined) {
        'use strict';
        var vmain, testdata, v_slide, step;
        var waitSlide = function () {
            var v = vmain.user_a * step;
            if (v === 0) {
                v = 1;
            }
            v_slide = weui.slider('#slider', {
                step: step,
                defaultValue: v,
                onChange: function (percent) {
                    vmain.setPos(percent);
                }
            });
        };
        var init = function () {
            testdata = $('#testdata').html();
            testdata = JSON.parse(testdata);
            vmain = new Vue({
                el: '#objmain',
                data: {
                    uname: testdata.uname,
                    name: testdata.name,
                    test: w.test,//问卷
                    ans: testdata.ans,//答案
                    cur_q: '',//问题
                    cur_a: undefined,//选项
                    cur_i: 0,//第几题
                    user_a: undefined,//用户的选择
                    slidepos: 0
                },
                methods: {
                    setPos: function (percent) {
                        vmain.slidepos = Math.round(percent / step);
                    },
                    next: function (n) {
                        vmain.ans[vmain.cur_i] = vmain.slidepos;
                        console.log(vmain.ans);
                        vmain.cur_i = vmain.cur_i + n;
                        if (vmain.cur_i >= vmain.test.length || vmain.cur_i < 0) {
                            vmain.cur_i = vmain.cur_i - n;
                            return;
                        }
                        var tmp = vmain.test[vmain.cur_i];
                        vmain.cur_q = tmp.q;
                        vmain.cur_a = tmp.a;
                        if (undefined === vmain.cur_a) {
                            vmain.slidepos = 0;
                            return;
                        }
                        vmain.user_a = vmain.ans[vmain.cur_i];
                        if (undefined === vmain.user_a) {
                            vmain.user_a = 0;
                        }
                        vmain.slidepos = vmain.user_a;
                        step = 10;
                        if (tmp.s) {
                            step = 100 / tmp.s;
                        }
                        requestAnimationFrame(waitSlide);
                    },
                    up: function () {
                        vmain.next(0);
                        $.ajax({
                            type: "POST",
                            url: "/hanbj/wxtest/up",
                            dataType: "json",
                            data: {
                                ans: vmain.ans,
                                obj: vmain.uname
                            },
                            success: function (msg) {
                                location.href = '/hanbj/mobile';
                            },
                            error: function (msg) {
                                msg = JSON.parse(msg.responseText);
                                w.msgto(msg.msg);
                            }
                        });
                    }
                }
            });
            vmain.next(0);
        };
        return {
            init: init
        };
    })(Zepto, Vue, window);
    $(window).on("load", function () {
        wx_init.init(false);
        wx_test.init();
    });
</script>