{layout name="layout" /}
<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <div class="row" style="margin:150px 0px 100px 0px">
                <div class="col-md-6 col-md-offset-3 column">
                    <div class="caption">
                        <h3 class="text-center">
                            汉服北京会员部管理系统
                        </h3>
                    </div>
                    <div class="row">
                        <div class="col-md-10 col-md-offset-1 column">
                            <form id="form" class="form-horizontal login-form" action="welcome" method="post"
                                  novalidate="novalidate">
                                <fieldset>
                                    <div class="form-group">
                                        <div class="controls">
                                            <input id="user" name="user" type="text" placeholder="用户名"
                                                   class="required form-control input-lg">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="controls">
                                            <input id="mm" name="mm" type="password" placeholder="密码"
                                                   class="required form-control input-lg">
                                        </div>
                                    </div>
                                    <div class="form-group form-inline">
                                        <div class="controls">
                                            <input id="capt" name="capt" type="text" placeholder="验证码"
                                                   class="required form-control input-lg" style="float: left">
                                            <img id="capt_img" src="/captcha.html" alt="captcha">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="control-group">
                                            <button type="button" id="login" class="btn btn-block btn-lg btn-primary">
                                                立即登录
                                            </button>
                                        </div>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                        <div class="col-md-1 column">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    window.onload = function () {
        var nonStr = '{$nonstr}';
        $('#capt_img').click(function () {
            $('#capt_img').attr('src', '/captcha.html?' + new Date());
        });
        $("#login").click(function () {
            mm = $('#mm').val();
            mm = CryptoJS.SHA1(mm).toString();
            mm += nonStr;
            mm = CryptoJS.SHA1(mm).toString();
            $('#mm').val(mm);
            d = $('#form').serializeArray();
            $.ajax({
                type: "POST",
                url: "/hanbj/index/json_login",
                data: d,
                dataType: "json",
                success: function (msg) {
                    location.reload(true);
                },
                error: function (msg) {
                    msg = JSON.parse(msg.responseText);
                    alert(msg.msg);
                    $('#capt_img').attr('src', '/captcha.html?' + new Date());
                    $('#mm').val('');
                    $('#capt').val('');
                }
            });
        });
    }
</script>